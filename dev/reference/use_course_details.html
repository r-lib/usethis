<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Helpers to download and unpack a ZIP file — use_course_details • usethis</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Helpers to download and unpack a ZIP file — use_course_details"><meta name="description" content="Details on the internal and helper functions that power use_course() and
use_zip(). Only create_download_url() is exported."><meta property="og:description" content="Details on the internal and helper functions that power use_course() and
use_zip(). Only create_download_url() is exported."><meta property="og:image" content="https://usethis.r-lib.org/logo.png"><meta name="robots" content="noindex"><script defer data-domain="usethis.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script></head><body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">usethis</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/usethis-setup.html">Setup</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/usethis-setup.html">usethis setup</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Git and GitHub</h6></li>
    <li><a class="dropdown-item" href="../articles/git-credentials.html">Managing Git(Hub) Credentials</a></li>
    <li><a class="dropdown-item" href="../articles/pr-functions.html">Pull request helpers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news"><li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/10/renaming-default-branch/">Renaming the default branch (usethis &gt;= 2.1.2)</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/12/usethis-2-0-0/">usethis 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/04/usethis-1-6-0/">usethis 1.6.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/04/usethis-1.5.0/">usethis 1.5.0 (and 1.4.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2018/02/usethis-1-3-0/">usethis 1.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2017/11/usethis-1.0.0/">usethis 1.0.0 (and 1.1.0)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/usethis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic" id="container">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Helpers to download and unpack a ZIP file</h1>
      <small class="dont-index">Source: <a href="https://github.com/r-lib/usethis/blob/main/R/course.R" class="external-link"><code>R/course.R</code></a></small>
      <div class="d-none name"><code>use_course_details.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Details on the internal and helper functions that power <code><a href="zip-utils.html">use_course()</a></code> and
<code><a href="zip-utils.html">use_zip()</a></code>. Only <code>create_download_url()</code> is exported.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">tidy_download</span><span class="op">(</span><span class="va">url</span>, destdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/getwd.html" class="external-link">getwd</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">tidy_unzip</span><span class="op">(</span><span class="va">zipfile</span>, cleanup <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">create_download_url</span><span class="op">(</span><span class="va">url</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-url">url<a class="anchor" aria-label="anchor" href="#arg-url"></a></dt>
<dd><p>A GitHub, DropBox, or Google Drive URL.</p><ul><li><p>For <code>create_download_url()</code>: A URL copied from a web browser.</p></li>
<li><p>For <code>tidy_download()</code>: A download link for a ZIP file, possibly behind a
shortlink or other redirect. <code>create_download_url()</code> can be helpful for
creating this URL from typical browser URLs.</p></li>
</ul></dd>


<dt id="arg-destdir">destdir<a class="anchor" aria-label="anchor" href="#arg-destdir"></a></dt>
<dd><p>Path to existing local directory where the ZIP file will be
stored. Defaults to current working directory, but note that <code><a href="zip-utils.html">use_course()</a></code>
has different default behavior.</p></dd>


<dt id="arg-zipfile">zipfile<a class="anchor" aria-label="anchor" href="#arg-zipfile"></a></dt>
<dd><p>Path to local ZIP file.</p></dd>


<dt id="arg-cleanup">cleanup<a class="anchor" aria-label="anchor" href="#arg-cleanup"></a></dt>
<dd><p>Whether to delete the ZIP file after unpacking. In an
interactive session, <code>cleanup = NA</code> leads to asking the user if they
want to delete or keep the ZIP file.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="tidy-download-">tidy_download()<a class="anchor" aria-label="anchor" href="#tidy-download-"></a></h2>



<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="co"># how it's used inside use_course()</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">tidy_download</span>(</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>  <span class="co"># url has been processed with internal helper normalize_url()</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>  url,</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>  <span class="co"># conspicuous_place() = `getOption('usethis.destdir')` or desktop or home</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>  <span class="co"># directory or working directory</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a>  <span class="at">destdir =</span> destdir <span class="sc">%||%</span> <span class="fu">conspicuous_place</span>()</span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a>)</span></code></pre><p></p></div>
<p>Special-purpose function to download a ZIP file and automatically determine
the file name, which often determines the folder name after unpacking.
Developed with DropBox and GitHub as primary targets, possibly via
shortlinks. Both platforms offer a way to download an entire folder or repo
as a ZIP file, with information about the original folder or repo transmitted
in the <code>Content-Disposition</code> header. In the absence of this header, a
filename is generated from the input URL. In either case, the filename is
sanitized. Returns the path to downloaded ZIP file, invisibly.</p>
<p><code>tidy_download()</code> is setup to retry after a download failure. In an
interactive session, it asks for user's consent. All retries use a longer
connect timeout.</p><div class="section">
<h3 id="dropbox">DropBox<a class="anchor" aria-label="anchor" href="#dropbox"></a></h3>


<p>To make a folder available for ZIP download, create a shared link for it:</p><ul><li><p><a href="https://help.dropbox.com/share/create-and-share-link" class="external-link">https://help.dropbox.com/share/create-and-share-link</a></p></li>
</ul><p>A shared link will have this form:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>www.dropbox.com<span class="sc">/</span>sh<span class="sc">/</span><span class="dv">12345</span>abcde<span class="sc">/</span><span class="dv">6789</span>wxyz?dl<span class="ot">=</span><span class="dv">0</span></span></code></pre><p></p></div>
<p>Replace the <code>dl=0</code> at the end with <code>dl=1</code> to create a download link:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>www.dropbox.com<span class="sc">/</span>sh<span class="sc">/</span><span class="dv">12345</span>abcde<span class="sc">/</span><span class="dv">6789</span>wxyz?dl<span class="ot">=</span><span class="dv">1</span></span></code></pre><p></p></div>
<p>You can use <code>create_download_url()</code> to do this conversion.</p>
<p>This download link (or a shortlink that points to it) is suitable as input
for <code>tidy_download()</code>. After one or more redirections, this link will
eventually lead to a download URL. For more details, see
<a href="https://help.dropbox.com/share/force-download" class="external-link">https://help.dropbox.com/share/force-download</a> and
<a href="https://help.dropbox.com/sync/download-entire-folders" class="external-link">https://help.dropbox.com/sync/download-entire-folders</a>.</p>
</div>

<div class="section">
<h3 id="github">GitHub<a class="anchor" aria-label="anchor" href="#github"></a></h3>


<p>Click on the repo's "Clone or download" button, to reveal a "Download ZIP"
button. Capture this URL, which will have this form:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>usethis<span class="sc">/</span>archive<span class="sc">/</span>main.zip</span></code></pre><p></p></div>
<p>This download link (or a shortlink that points to it) is suitable as input
for <code>tidy_download()</code>. After one or more redirections, this link will
eventually lead to a download URL. Here are other links that also lead to
ZIP download, albeit with a different filenaming scheme (REF could be a
branch name, a tag, or a SHA):</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>github.com<span class="sc">/</span>github.com<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>usethis<span class="sc">/</span>zipball<span class="sc">/</span>HEAD</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>api.github.com<span class="sc">/</span>repos<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>rematch2<span class="sc">/</span>zipball<span class="sc">/</span>REF</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>api.github.com<span class="sc">/</span>repos<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>rematch2<span class="sc">/</span>zipball<span class="sc">/</span>HEAD</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>api.github.com<span class="sc">/</span>repos<span class="sc">/</span>r<span class="sc">-</span>lib<span class="sc">/</span>usethis<span class="sc">/</span>zipball<span class="sc">/</span>REF</span></code></pre><p></p></div>
<p>You can use <code>create_download_url()</code> to create the "Download ZIP" URL from
a typical GitHub browser URL.</p>
</div>

<div class="section">
<h3 id="google-drive">Google Drive<a class="anchor" aria-label="anchor" href="#google-drive"></a></h3>


<p>To our knowledge, it is not possible to download a Google Drive folder as a
ZIP archive. It is however possible to share a ZIP file stored on Google
Drive. To get its URL, click on "Get the shareable link" (within the "Share"
menu). This URL doesn't allow for direct download, as it's designed to be
processed in a web browser first. Such a sharing link looks like:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>drive.google.com<span class="sc">/</span>open?id<span class="ot">=</span><span class="dv">123456789</span>xxyyyzzz</span></code></pre><p></p></div>
<p>To be able to get the URL suitable for direct download, you need to extract
the "id" element from the URL and include it in this URL format:</p>
<p></p><div class="sourceCode"><pre><code><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>https<span class="sc">:</span><span class="er">//</span>drive.google.com<span class="sc">/</span>uc?export<span class="ot">=</span>download<span class="sc">&amp;</span>id<span class="ot">=</span><span class="dv">123456789</span>xxyyyzzz</span></code></pre><p></p></div>
<p>Use <code>create_download_url()</code> to perform this transformation automatically.</p>
</div>

    </div>
    <div class="section level2">
    <h2 id="tidy-unzip-">tidy_unzip()<a class="anchor" aria-label="anchor" href="#tidy-unzip-"></a></h2>



<p>Special-purpose function to unpack a ZIP file and (attempt to) create the
directory structure most people want. When unpacking an archive, it is easy
to get one more or one less level of nesting than you expected.</p>
<p>It's especially important to finesse the directory structure here: we want
the same local result when unzipping the same content from either GitHub or
DropBox ZIP files, which pack things differently. Here is the intent:</p><ul><li><p>If the ZIP archive <code>foo.zip</code> does not contain a single top-level directory,
i.e. it is packed as "loose parts", unzip into a directory named <code>foo</code>.
Typical of DropBox ZIP files.</p></li>
<li><p>If the ZIP archive <code>foo.zip</code> has a single top-level directory (which, by
the way, is not necessarily called "foo"), unpack into said directory.
Typical of GitHub ZIP files.</p></li>
</ul><p>Returns path to the directory holding the unpacked files, invisibly.</p>
<p><strong>DropBox:</strong>
The ZIP files produced by DropBox are special. The file list tends to contain
a spurious directory <code>"/"</code>, which we ignore during unzip. Also, if the
directory is a Git repo and/or RStudio Project, we unzip-ignore various
hidden files, such as <code>.RData</code>, <code>.Rhistory</code>, and those below <code>.git/</code> and
<code>.Rproj.user</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="fu">tidy_download</span><span class="op">(</span><span class="st">"https://github.com/r-lib/rematch2/archive/main.zip"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">tidy_unzip</span><span class="op">(</span><span class="st">"rematch2-main.zip"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span><span class="co"># GitHub</span></span></span>
<span class="r-in"><span><span class="fu">create_download_url</span><span class="op">(</span><span class="st">"https://github.com/r-lib/usethis"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "https://github.com/r-lib/usethis/zipball/HEAD"</span>
<span class="r-in"><span><span class="fu">create_download_url</span><span class="op">(</span><span class="st">"https://github.com/r-lib/usethis/issues"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "https://github.com/r-lib/usethis/zipball/HEAD"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># DropBox</span></span></span>
<span class="r-in"><span><span class="fu">create_download_url</span><span class="op">(</span><span class="st">"https://www.dropbox.com/sh/12345abcde/6789wxyz?dl=0"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "https://www.dropbox.com/sh/12345abcde/6789wxyz?dl=1"</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Google Drive</span></span></span>
<span class="r-in"><span><span class="fu">create_download_url</span><span class="op">(</span><span class="st">"https://drive.google.com/open?id=123456789xxyyyzzz"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "https://drive.google.com/uc?export=download&amp;id=123456789xxyyyzzz"</span>
<span class="r-in"><span><span class="fu">create_download_url</span><span class="op">(</span><span class="st">"https://drive.google.com/open?id=123456789xxyyyzzz/view"</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] "https://drive.google.com/uc?export=download&amp;id=123456789xxyyyzzz"</span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, Malcolm Barrett, Andy Teucher, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer></body></html>

