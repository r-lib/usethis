<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Converting usethis's UI to use cli • usethis</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Source_Sans_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Source_Code_Pro-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Converting usethis's UI to use cli">
<meta name="robots" content="noindex">
<script defer data-domain="usethis.r-lib.org,all.tidyverse.org" src="https://plausible.io/js/plausible.js"></script>
</head>
<body>
    <a href="#container" class="visually-hidden-focusable">Skip to content</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-none" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">usethis</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">3.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/usethis-setup.html">Setup</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/usethis-setup.html">usethis setup</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Git and GitHub</h6></li>
    <li><a class="dropdown-item" href="../articles/git-credentials.html">Managing Git(Hub) Credentials</a></li>
    <li><a class="dropdown-item" href="../articles/pr-functions.html">Pull request helpers</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-news" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">News</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-news">
<li><h6 class="dropdown-header" data-toc-skip>Releases</h6></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2021/10/renaming-default-branch/">Renaming the default branch (usethis &gt;= 2.1.2)</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/12/usethis-2-0-0/">usethis 2.0.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2020/04/usethis-1-6-0/">usethis 1.6.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2019/04/usethis-1.5.0/">usethis 1.5.0 (and 1.4.0)</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2018/02/usethis-1-3-0/">usethis 1.3.0</a></li>
    <li><a class="external-link dropdown-item" href="https://www.tidyverse.org/blog/2017/11/usethis-1.0.0/">usethis 1.0.0 (and 1.1.0)</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../news/index.html">Changelog</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/r-lib/usethis/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article" id="container">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Converting usethis's UI to use cli</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/usethis/blob/main/vignettes/articles/ui-cli-conversion.Rmd" class="external-link"><code>vignettes/articles/ui-cli-conversion.Rmd</code></a></small>
      <div class="d-none name"><code>ui-cli-conversion.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://usethis.r-lib.org">usethis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://glue.tidyverse.org/" class="external-link">glue</a></span><span class="op">)</span></span></code></pre></div>
<p><em>In a hidden chunk here, I’m “exporting” some unexported internal
helpers, so that I can use them and talk about them. For similar
reasons, I attach glue above, so that certain glue functions work here,
without explicitly namespacing them.</em></p>
<div class="section level2">
<h2 id="block-styles">Block styles<a class="anchor" aria-label="anchor" href="#block-styles"></a>
</h2>
<p>The block styles exist to produce bulleted output with a specific
symbol, using a specific color.</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; f &lt;- function() {                                                     
+   ui_todo("ui_todo(): red bullet")                                    
+   ui_done("ui_done(): green check")                                   
+   ui_oops("ui_oops(): red x")                                         
+   ui_info("ui_info(): yellow i")                                      
+   ui_line("ui_line(): (no symbol)")                                   
+ }                                                                     
&gt; f()                                                                   
<span style="color: #DC322F;">•</span> ui_todo(): red bullet                                                 
<span style="color: #859900;">✔</span> ui_done(): green check                                                
<span style="color: #DC322F;">✖</span> ui_oops(): red x                                                      
<span style="color: #B58900;">ℹ</span> ui_info(): yellow i                                                   
ui_line(): (no symbol)                                                  
</pre>
</div>
<p>Another important feature is that all of this output can be turned
off package-wide via the <code>usethis.quiet</code> option.</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; withr::with_options(                                                  
+   list(usethis.quiet = TRUE),                                         
+   ui_info("You won't see this message.")                              
+ )                                                                     
&gt; withr::with_options(                                                  
+   list(usethis.quiet = FALSE), # this is the default                  
+   ui_info("But you will see this one.")                               
+ )                                                                     
<span style="color: #B58900;">ℹ</span> But you will see this one.                                            
</pre>
</div>
<p>These styles are very close to what can be done with
<code><a href="https://cli.r-lib.org/reference/cli_bullets.html" class="external-link">cli::cli_bullets()</a></code> and the way it responds to the names of
its input <code>text</code>.</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; cli::cli_bullets(c(                                                   
+         "noindent",                                                   
+   " " = "indent",                                                     
+   "*" = "bullet",                                                     
+   "&gt;" = "arrow",                                                      
+   "v" = "success",                                                    
+   "x" = "danger",                                                     
+   "!" = "warning",                                                    
+   "i" = "info"                                                        
+ ))                                                                    
noindent                                                                
  indent                                                                
<span style="color: #2AA198;">•</span> bullet                                                                
→ arrow                                                                 
<span style="color: #859900;">✔</span> success                                                               
<span style="color: #DC322F;">✖</span> danger                                                                
<span style="color: #B58900;">!</span> warning                                                               
<span style="color: #2AA198;">ℹ</span> info                                                                  
</pre>
</div>
<p>A direct translation would look something like this:</p>
<table class="table">
<colgroup>
<col width="22%">
<col width="36%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th>Legacy <code>ui_*()</code>
</th>
<th>
<code>cli_bullets()</code> shortcode</th>
<th>tweaks needed</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code><a href="../reference/ui-legacy-functions.html">ui_todo()</a></code></td>
<td><code>*</code></td>
<td>blue (default) -&gt; red</td>
</tr>
<tr class="even">
<td><code><a href="../reference/ui-legacy-functions.html">ui_done()</a></code></td>
<td><code>v</code></td>
<td>perfect match</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/ui-legacy-functions.html">ui_oops()</a></code></td>
<td><code>x</code></td>
<td>perfect match</td>
</tr>
<tr class="even">
<td><code><a href="../reference/ui-legacy-functions.html">ui_info()</a></code></td>
<td><code>i</code></td>
<td>blue (default) -&gt; yellow</td>
</tr>
<tr class="odd">
<td><code><a href="../reference/ui-legacy-functions.html">ui_line()</a></code></td>
<td>(unnamed)</td>
<td>sort of a perfect match? although sometimes <code><a href="../reference/ui-legacy-functions.html">ui_line()</a></code>
is used just to get a blank line</td>
</tr>
</tbody>
</table>
<p>The overall conversion plan is to switch to a new function,
<code>ui_bullets()</code>, which is a wrapper around
<code><a href="https://cli.r-lib.org/reference/cli_bullets.html" class="external-link">cli::cli_bullets()</a></code>, that adds a few features:</p>
<ul>
<li>Early exit, without emitting messages, if the
<code>usethis.quiet</code> option is <code>TRUE</code>.</li>
<li>A usethis theme, that changes the color of certain bullet styles and
adds a new style for todo’s.</li>
</ul>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; ui_bullets(c(                                                         
+   "v" = "A great success!",                                           
+   "_" = "Something you need to do.",                                  
+   "x" = "Bad news.",                                                  
+   "i" = "The more you know.",                                         
+   " " = "I'm just here for the indentation.",                         
+   "No indentation at all. Not used much in usethis."                  
+ ))                                                                    
<span style="color: #859900;">✔</span> A great success!                                                      
<span style="color: #DC322F;">☐</span> Something you need to do.                                             
<span style="color: #DC322F;">✖</span> Bad news.                                                             
<span style="color: #B58900;">ℹ</span> The more you know.                                                    
  I'm just here for the indentation.                                    
No indentation at all. Not used much in usethis.                        
</pre>
</div>
<p>Summary of what I’ve done for todo’s:</p>
<ul>
<li>Introduce a new bullet shortcode for a todo. Proposal:
<code>_</code> (instead of <code>*</code>), which seems to be the best
single ascii character that evokes a place to check something off.</li>
<li>Use <code>cli::symbol$checkbox_off</code> as the symbol (instead of
a generic bullet). I guess it will continue to be red.</li>
</ul>
<p>In terms of the block styles, that just leaves
<code><a href="../reference/ui-legacy-functions.html">ui_code_block()</a></code>, which is pretty different.
<code><a href="../reference/ui-legacy-functions.html">ui_code_block()</a></code> is used to put some code on the screen and
optionally place it on the clipboard. I have created a new function,
<code>ui_code_snippet()</code> that is built around
<code>cli::code_block()</code>. Main observations:</p>
<ul>
<li>
<code>cli::code_block(language = "R")</code> applies syntax
highlighting and hyperlinks (e.g. to function help topics) to R code,
which is cool. Therefore the <code>language</code> argument is also
exposed in <code>ui_code_snippet()</code>, defaulting to
<code>"R"</code>. Use <code>""</code> for anything that’s not R code:
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
  &gt; ui_code_snippet("x &lt;- 1 + 2")                                         
    x <span style="color: #cc9900;">&lt;-</span> <span style="color: #cc3399;">1</span> <span style="color: #cc9900;">+</span> <span style="color: #cc3399;">2</span>                                                            
  &gt; ui_code_snippet("#include &lt;blah.h&gt;", language = "")                   
    #include &lt;blah.h&gt;                                                     
  </pre>
</div>
</li>
<li>
<code>ui_code_snippet()</code> takes a scalar glue-type template
string or a vector of lines. Note that the two calls below produce the
same output.
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
  &gt; ui_code_snippet("                                                     
  +   options(                                                            
  +     warnPartialMatchArgs = TRUE,                                      
  +     warnPartialMatchDollar = TRUE,                                    
  +     warnPartialMatchAttr = TRUE                                       
  +   )")                                                                 
    <span style="font-weight: bold;">options</span><span style="color: #cc9900;">(</span>                                                              
      warnPartialMatchArgs = <span style="color: #cc3399;">TRUE</span>,                                        
      warnPartialMatchDollar = <span style="color: #cc3399;">TRUE</span>,                                      
      warnPartialMatchAttr = <span style="color: #cc3399;">TRUE</span>                                         
    <span style="color: #cc9900;">)</span>                                                                     
  &gt; # produces same result as                                             
  &gt; ui_code_snippet(c(                                                    
  +   "options(",                                                         
  +   "  warnPartialMatchArgs = TRUE,",                                   
  +   "  warnPartialMatchDollar = TRUE,",                                 
  +   "  warnPartialMatchAttr = TRUE",                                    
  +   ")"))                                                               
    <span style="font-weight: bold;">options</span><span style="color: #cc9900;">(</span>                                                              
      warnPartialMatchArgs = <span style="color: #cc3399;">TRUE</span>,                                        
      warnPartialMatchDollar = <span style="color: #cc3399;">TRUE</span>,                                      
      warnPartialMatchAttr = <span style="color: #cc3399;">TRUE</span>                                         
    <span style="color: #cc9900;">)</span>                                                                     
  </pre>
</div>
</li>
<li>
<code>ui_code_snippet()</code> does glue interpolation, by default,
before calling <code><a href="https://cli.r-lib.org/reference/cli_code.html" class="external-link">cli::cli_code()</a></code>, which means you have to
think about your use of <code>{</code> and <code>}</code>. If you want
literal <code>{</code> or <code>}</code>:
<ul>
<li>Use <code>interpolate = FALSE</code>, if you don’t need
interpolation.</li>
<li>Do the usual glue thing and double them, i.e. <code>{{</code> or
<code>}}</code>.</li>
<li>If this becomes a real pain, open an issue/PR about adding
<code>.open</code> and <code>.close</code> as arguments to
<code>ui_code_snippet()</code>.</li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="utility-functions">Utility functions<a class="anchor" aria-label="anchor" href="#utility-functions"></a>
</h2>
<p>The block style functions all route through some unexported utility
functions.</p>
<p><code>is_quiet()</code> just consults the <code>usethis.quiet</code>
option and implements the default of <code>FALSE</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">is_quiet</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/Logic.html" class="external-link">isTRUE</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"usethis.quiet"</span>, default <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p><code>ui_bullet()</code> is an intermediate helper used by
<code><a href="../reference/ui-legacy-functions.html">ui_todo()</a></code>, <code><a href="../reference/ui-legacy-functions.html">ui_done()</a></code>, <code><a href="../reference/ui-legacy-functions.html">ui_oops()</a></code>
and <code><a href="../reference/ui-legacy-functions.html">ui_info()</a></code>. It does some hygiene related to indentation
(using the <code>indent()</code> utility function), then calls
<code>ui_inform()</code>. <code><a href="../reference/ui-legacy-functions.html">ui_line()</a></code> and
<code><a href="../reference/ui-legacy-functions.html">ui_code()</a></code> both call <code>ui_inform()</code> directly.</p>
<p><code>ui_inform()</code> is just a wrapper around
<code><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">rlang::inform()</a></code> that is guarded by a call to
<code>is_quiet()</code></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui_inform</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu">is_quiet</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu">inform</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">...</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Other than <code>is_quiet()</code>, which will continue to play the
same role, I anticipate that we no longer need these utilities
(<code>indent()</code>, <code>ui_bullet()</code>,
<code>ui_inform()</code>). Updates from the future:</p>
<ul>
<li>
<code>indent()</code> turns out to still be useful in
<code>ui_code_snippet()</code>, so I’ve inlined it there, to avoid any
reliance on definitions in ui-legacy.R.</li>
<li>
<code>ui_bullet()</code> has been renamed to
<code>ui_legacy_bullet()</code> for auto-completion happiness with the
new <code>ui_bullets()</code>.</li>
</ul>
<p>Let’s cover <code><a href="../reference/ui_silence.html">ui_silence()</a></code> while we’re here, which
<em>is</em> exported. It’s just a <code>withr::with_*()</code> function
for executing <code>code</code> with
<code>usethis.quiet = TRUE</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui_silence</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">code</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">withr</span><span class="fu">::</span><span class="fu"><a href="https://withr.r-lib.org/reference/with_options.html" class="external-link">with_options</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>usethis.quiet <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, <span class="va">code</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="inline-styles">Inline styles<a class="anchor" aria-label="anchor" href="#inline-styles"></a>
</h2>
<div class="section level3">
<h3 id="legacy-functions">Legacy functions<a class="anchor" aria-label="anchor" href="#legacy-functions"></a>
</h3>
<p>usethis has its own inline styles (mostly) for use inside functions
like <code><a href="../reference/ui-legacy-functions.html">ui_todo()</a></code>:</p>
<ul>
<li><code><a href="../reference/ui-legacy-functions.html">ui_field()</a></code></li>
<li><code><a href="../reference/ui-legacy-functions.html">ui_value()</a></code></li>
<li><code><a href="../reference/ui-legacy-functions.html">ui_path()</a></code></li>
<li><code><a href="../reference/ui-legacy-functions.html">ui_code()</a></code></li>
<li><code><a href="../reference/ui-legacy-functions.html">ui_unset()</a></code></li>
</ul>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; new_val &lt;- "oxnard"                                                   
&gt; x &lt;- glue("{ui_field('name')} set to {ui_value(new_val)}")            
&gt; dput(x)                                                               
structure("\033[32mname\033[39m set to \033[34m'oxnard'\033[39m", class 
= c("glue",                                                             
"character"))                                                           
&gt; ui_done(x)                                                            
<span style="color: #859900;">✔</span> <span style="color: #859900;">name</span> set to <span style="color: #268BD2;">'oxnard'</span>                                                  
</pre>
</div>
<p>The inline styles enact some combination of:</p>
<ul>
<li>Color, e.g. <code>crayon::green(x)</code>
</li>
<li>Collapsing a collection of things to one thing,
e.g. <code>c("a", "b", "c")</code> to “a, b, c”</li>
<li>Quoting, e.g. <code>encodeString(x, quote = "'")</code>
</li>
</ul>
<p><code><a href="../reference/ui-legacy-functions.html">ui_path()</a></code> is special because it potentially modifies the
input before styling it. <code><a href="../reference/ui-legacy-functions.html">ui_path()</a></code> first makes the path
relative to a specific base (by default, the active project root) and,
if the path is a directory, it also ensures there is a trailing
<code>/</code>.</p>
<p><code><a href="../reference/ui-legacy-functions.html">ui_unset()</a></code> is a special purpose helper used when we need
to report that something is unknown, not configured, nonexistent,
etc.</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; x &lt;- glue("Your super secret password is {ui_unset()}.")              
&gt; dput(x)                                                               
structure("Your super secret password is \033[90m&lt;unset&gt;\033[39m.", clas
s = c("glue",                                                           
"character"))                                                           
&gt; ui_info(x)                                                            
<span style="color: #B58900;">ℹ</span> Your super secret password is <span style="color: #002B36;">&lt;unset&gt;</span>.                                
</pre>
</div>
</div>
<div class="section level3">
<h3 id="cli-replacements">cli replacements<a class="anchor" aria-label="anchor" href="#cli-replacements"></a>
</h3>
<p>In general, we can move towards cli’s native inline-markup: <a href="https://cli.r-lib.org/reference/inline-markup.html" class="external-link uri">https://cli.r-lib.org/reference/inline-markup.html</a></p>
<p>Here’s the general conversion plan:</p>
<ul>
<li><p><code><a href="../reference/ui-legacy-functions.html">ui_field()</a></code> becomes <code>{.field blah}</code>. In
<code>usethis_theme()</code>, I tweak the <code>.field</code> style to
apply single quotes if color is not available, which is what
<code><a href="../reference/ui-legacy-functions.html">ui_field()</a></code> has always done.</p></li>
<li><p><code><a href="../reference/ui-legacy-functions.html">ui_value()</a></code> becomes
<code>{.val value}</code>.</p></li>
<li>
<p><code><a href="../reference/ui-legacy-functions.html">ui_path()</a></code> is connected to
<code>{.path path/to/thing}</code>, but, as explained above,
<code><a href="../reference/ui-legacy-functions.html">ui_path()</a></code> also does more. Therefore, I abstracted the “path
math” into an internal helper, <code>ui_path_impl()</code>, which is
aliased to <code>pth()</code> for compactness. Here’s a typical
conversion:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># using legacy functions</span></span>
<span><span class="fu"><a href="../reference/ui-legacy-functions.html">ui_done</a></span><span class="op">(</span><span class="st">"Setting {ui_field('LazyData')} to \\</span></span>
<span><span class="st">         {ui_value('true')} in {ui_path('DESCRIPTION')}"</span><span class="op">)</span></span>
<span><span class="co"># using new cli-based ui</span></span>
<span><span class="fu">ui_bullets</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"v"</span> <span class="op">=</span> <span class="st">"Setting {.field LazyData} to {.val true} in {.path {pth('DESCRIPTION')}}."</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It would be nice to create a custom inline class,
e.g. <code>{.ui_path {some_path}}</code>, which I have done in, e.g.,
googledrive. But it’s not easy to do this <em>while still inheriting
cli’s <code>file:</code> hyperlink behaviour</em>, which is very
desirable. So that leads to the somewhat clunky, verbose pattern above,
but it gives a nice result.</p>
</li>
<li>
<p><code><a href="../reference/ui-legacy-functions.html">ui_code()</a></code> gets replaced by various inline styles,
depending on what the actual goal is, such as:</p>
<ul>
<li><code>{.code some_text}</code></li>
<li><code>{.arg some_argument}</code></li>
<li><code>{.cls some_class}</code></li>
<li><code>{.fun devtools::build_readme}</code></li>
<li><code>{.help some_function}</code></li>
<li><code>{.run usethis::usethis_function()}</code></li>
<li><code>{.topic some_topic}</code></li>
<li><code>{.var some_variable}</code></li>
</ul>
</li>
<li><p><code><a href="../reference/ui-legacy-functions.html">ui_unset()</a></code> is replaced by <code>ui_special()</code>,
which you’ll see more of below. Currently the intended grey color
doesn’t show up when I render this document using solarized-dark and so
far I can’t get to the bottom of that :( Why isn’t it the same grey as
“[Copied to clipboard]” in <code>ui_code_snippet()</code>, which does
work?</p></li>
</ul>
</div>
</div>
<div class="section level2">
<h2 id="conditions">Conditions<a class="anchor" aria-label="anchor" href="#conditions"></a>
</h2>
<p>I’m moving from <code><a href="../reference/ui-legacy-functions.html">ui_stop()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui_stop</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">.envir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue_collapse.html" class="external-link">glue_collapse</a></span><span class="op">(</span><span class="va">x</span>, <span class="st">"\n"</span><span class="op">)</span></span>
<span>  <span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://glue.tidyverse.org/reference/glue.html" class="external-link">glue</a></span><span class="op">(</span><span class="va">x</span>, .envir <span class="op">=</span> <span class="va">.envir</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">cnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"usethis_error"</span>, <span class="st">"error"</span>, <span class="st">"condition"</span><span class="op">)</span>,</span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>message <span class="op">=</span> <span class="va">x</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="va">cnd</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>to <code>ui_abort()</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui_abort</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">message</span>, <span class="va">...</span>, <span class="va">class</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">.envir</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sys.parent.html" class="external-link">parent.frame</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_div.html" class="external-link">cli_div</a></span><span class="op">(</span>theme <span class="op">=</span> <span class="fu">usethis_theme</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># bullet naming gymnastics, see below</span></span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli_abort</a></span><span class="op">(</span></span>
<span>    <span class="va">message</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">class</span>, <span class="st">"usethis_error"</span><span class="op">)</span>,</span>
<span>    .envir <span class="op">=</span> <span class="va">.envir</span>,</span>
<span>    <span class="va">...</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The main point of <code>ui_abort()</code> is to use to
<code>cli_abort()</code> (and to continue applying the
<code>"usethis_error"</code> class).</p>
<p>I also use <code>ui_abort()</code> to apply different default bullet
naming/styling. Starting with <code>"x"</code> and then defaulting to
<code>"i"</code> seems to fit best with usethis’s existing errors.</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; block_start = "# &lt;&lt;&lt;"                                                 
&gt; block_end = "# &gt;&gt;&gt;"                                                   
&gt; ui_abort(c(                                                           
+   "Invalid block specification.",                                     
+   "Must start with {.code {block_start}} and end with {.code {block_en
d}}."                                                                   
+ ))                                                                    
<span style="font-weight: bold;color: #B58900;">Error</span><span style="font-weight: bold;">:</span>                                                                  
<span style="color: #DC322F;">✖</span> Invalid block specification.                                          
<span style="color: #2AA198;">ℹ</span> Must start with `# &lt;&lt;&lt;` and end with `# &gt;&gt;&gt;`.                         
<span style="color: #002B36;">Run `rlang::last_trace()` to see where the error occurred.</span>              
</pre>
</div>
<p>Any bullets that are explicitly given are honored.</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
atever."))                                                              
<span style="font-weight: bold;color: #B58900;">Error</span><span style="font-weight: bold;">:</span>                                                                  
<span style="color: #859900;">✔</span> It's weird to give a green check in an error, but whatever.           
<span style="color: #002B36;">Run `rlang::last_trace()` to see where the error occurred.</span>              
&gt; ui_abort(c(                                                           
+   "!" = "Things are not ideal.",                                      
+   "&gt;" = "Look at me!"                                                 
+ ))                                                                    
<span style="font-weight: bold;color: #B58900;">Error</span><span style="font-weight: bold;">:</span>                                                                  
<span style="color: #B58900;">!</span> Things are not ideal.                                                 
→ Look at me!                                                           
<span style="color: #002B36;">Run `rlang::last_trace()` to see where the error occurred.</span>              
</pre>
</div>
<p><code><a href="https://rlang.r-lib.org/reference/abort.html" class="external-link">rlang::abort()</a></code> and <code><a href="https://cli.r-lib.org/reference/cli_abort.html" class="external-link">cli::cli_abort()</a></code> start
with <code>"!"</code> by default, then use <code>"*"</code> and
<code>" "</code>, respectively.</p>
<p>The legacy functions also include <code><a href="../reference/ui-legacy-functions.html">ui_warn()</a></code>. It has very
little usage and, instead of converting it, I’ve eliminated its use
altogether in favor of a <code>"!"</code> bullet:</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; ui_bullets(c("!" = "The guy she told you not to worry about."))       
<span style="color: #B58900;">!</span> The guy she told you not to worry about.                              
</pre>
</div>
<p>Sidebar: Now that I’m looking at a lot of the new errors with
<code>ui_abort()</code> I realize that usethis also needs to be passing
the <code>call</code> argument along. I’m going to leave that for a
future, separate effort.</p>
</div>
<div class="section level2">
<h2 id="sitrep-and-format-helpers">Sitrep and format helpers<a class="anchor" aria-label="anchor" href="#sitrep-and-format-helpers"></a>
</h2>
<p>This is a small clump of functions that support sitrep-type
output.</p>
<ul>
<li>
<code>hd_line()</code> <em>unexported and, apparently, unused! now
removed</em>
</li>
<li>
<code>kv_line()</code> <em>unexported, so has new cli
implementation</em>
</li>
<li>
<code><a href="../reference/ui-legacy-functions.html">ui_unset()</a></code> <em>exported and succeeded by
<code>ui_special()</code></em>
</li>
</ul>
<p><code>kv_line()</code> stands for “key-value line”. Here’s what it
used to be:</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; kv_line_legacy &lt;- function(key, value, .envir = parent.frame()) {     
+   value &lt;- if (is.null(value)) ui_unset() else ui_value(value)        
+   key &lt;- glue(key, .envir = .envir)                                   
+   ui_inform(glue("{cli::symbol$bullet} {key}: {value}"))              
+ }                                                                     
&gt;                                                                       
&gt; url &lt;- "https://github.com/r-lib/usethis.git"                         
&gt; remote &lt;- "origin"                                                    
&gt; kv_line_legacy("URL for the {ui_value(remote)} remote", url)          
• URL for the <span style="color: #268BD2;">'origin'</span> remote: <span style="color: #268BD2;">'https://github.com/r-lib/usethis.git'</span>   
&gt;                                                                       
&gt; host &lt;- "github.com"                                                  
&gt; kv_line_legacy("Personal access token for {ui_value(host)}", NULL)    
• Personal access token for <span style="color: #268BD2;">'github.com'</span>: <span style="color: #002B36;">&lt;unset&gt;</span>                       
</pre>
</div>
<p>Key features:</p>
<ul>
<li>Interpolates data and applies inline style to the result. Works
differently for <code>key</code> and <code>value</code>, because you’re
much more likely to use interpolation and styling in <code>key</code>
than <code>value</code>.</li>
<li>Has special handling when <code>value</code> is
<code>NULL</code>.</li>
<li>Applies <code>"*"</code> bullet name/style to over all result.</li>
</ul>
<p>I won’t show the updated source for <code>kv_line()</code> but here
is some usage to show what it’s capable of:</p>
<div class="asciicast" style="color: #657B83;font-family: 'Fira Code',Monaco,Consolas,Menlo,'Bitstream Vera Sans Mono','Powerline Symbols',monospace;line-height: 1.300000">
<pre>
&gt; noun &lt;- "thingy"                                                      
&gt; value &lt;- "VALUE"                                                      
&gt; kv_line("Let's reveal {.field {noun}}", "whatever")                   
• Let's reveal <span style="color: #859900;">thingy</span>: <span style="color: #268BD2;">"whatever"</span>                                       
&gt;                                                                       
&gt; kv_line("URL for the {.val {remote}} remote", I("{.url {url}}"))      
• URL for the <span style="color: #268BD2;">"origin"</span> remote: <span style="font-style: italic;color: #268BD2;">&lt;https://github.com/r-lib/usethis.git&gt;</span>   
&gt;                                                                       
&gt; kv_line("Personal access token for {.val {host}}", NULL)              
• Personal access token for <span style="color: #268BD2;">"github.com"</span>: <span style="color: #002B36;">&lt;unset&gt;</span>                       
&gt;                                                                       
&gt; kv_line("Personal access token for {.val {host}}", ui_special("discove
red"))                                                                  
• Personal access token for <span style="color: #268BD2;">"github.com"</span>: <span style="color: #002B36;">&lt;discovered&gt;</span>                  
</pre>
</div>
<p><code>ui_special()</code> is the successor to
<code><a href="../reference/ui-legacy-functions.html">ui_unset()</a></code>.</p>
</div>
<div class="section level2">
<h2 id="questions">Questions<a class="anchor" aria-label="anchor" href="#questions"></a>
</h2>
<p>There’s currently no drop-in substitute for <code><a href="../reference/ui-questions.html">ui_yeah()</a></code>
and <code><a href="../reference/ui-questions.html">ui_nope()</a></code> in cli. Related issues: <a href="https://github.com/r-lib/cli/issues/228" class="external-link uri">https://github.com/r-lib/cli/issues/228</a>, <a href="https://github.com/r-lib/cli/issues/488" class="external-link uri">https://github.com/r-lib/cli/issues/488</a>. Therefore, in
the meantime, <code><a href="../reference/ui-questions.html">ui_yeah()</a></code> and <code><a href="../reference/ui-questions.html">ui_nope()</a></code> are
not-quite-superseded for external users.</p>
<p>However, internally, I’ve switched to the unexported functions
<code>ui_yep()</code> and <code>ui_nah()</code> that are lightly
modified versions of <code><a href="../reference/ui-questions.html">ui_yeah()</a></code> and <code><a href="../reference/ui-questions.html">ui_nope()</a></code>
that use cli for styling.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="../reference/ui-questions.html">ui_nope</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">      Current branch ({ui_value(actual)}) is not repo's default \\</span></span>
<span><span class="st">      branch ({ui_value(default_branch)}).{details}"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="fu">ui_abort</span><span class="op">(</span><span class="st">"Cancelling. Not on desired branch."</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="miscellaneous-notes">Miscellaneous notes<a class="anchor" aria-label="anchor" href="#miscellaneous-notes"></a>
</h2>
<ul>
<li><p>I’ve been adding a period to the end of messages, as a general
rule.</p></li>
<li>
<p>In terms of whitespace and indentation, I’ve settled on some
conventions. The overall goal is to get the right user-facing output
(obviously), while making it as easy as possible to <em>predict</em>
what that’s going to look like when you’re writing the code.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ui_bullets</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"i"</span> <span class="op">=</span> <span class="st">"Downloading into {.path {pth(destdir)}}."</span>,</span>
<span>  <span class="st">"_"</span> <span class="op">=</span> <span class="st">"Prefer a different location? Cancel, try again, and specify</span></span>
<span><span class="st">         {.arg destdir}."</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">...</span></span>
<span><span class="fu">ui_bullets</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="st">"Things are very wrong."</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Key points:</p>
<ul>
<li><p>Put <code>ui_bullets(c(</code> on its own line, then all of the
bullet items, followed by <code>))</code> on its own line. Sometimes I
make an exception for a bullet list with exactly one, short bullet
item.</p></li>
<li><p>Use hard line breaks inside bullet text to comply with
surrounding line length. In subsequent lines, use indentation to get you
just past the opening <code>"</code>. This extraneous white space is
later rationalized by cli, which handles wrapping.</p></li>
<li><p>Surround bullet names like <code>x</code> and <code>i</code> with
quotes, even though you don’t have to, because it’s required for other
names, such as <code>!</code> or <code>_</code> and it’s better to be
consistent.</p></li>
<li>
<p>Here’s another style I like that applies to
<code>ui_abort()</code>, where there’s just one, unnamed bullet, but the
call doesn’t fit on one line.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>pr_number <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span>
<span><span class="fu">ui_abort</span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  The repo or branch where PR #{pr$pr_number} originates seems to have been</span></span>
<span><span class="st">  deleted."</span><span class="op">)</span></span></code></pre></div>
</li>
</ul>
</li>
</ul>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



   </div>
  <footer><div class="container">
  <div class="pkgdown-footer-left">
  <p>Developed by <a href="https://hadley.nz" class="external-link">Hadley Wickham</a>, <a href="https://jennybryan.org" class="external-link">Jennifer Bryan</a>, Malcolm Barrett, Andy Teucher, <a href="https://www.posit.co" class="external-link"><img src="https://www.tidyverse.org/posit-logo.svg" alt="Posit" height="16" width="62" style="margin-bottom: 3px;"></a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

  </div></footer>
</body>
</html>
